<link rel="import" href="function-contracts-list.html">
<link rel="import" href="contract-info.html">

<dom-module id="contracts-scene">
    <style>
 

        .btn-save {
            background-color: var(--brand-color);
            color: white;
        }

        .container {
            @apply --layout-vertical;
            padding-top: 40px;
        }
    </style>

    <template>
        <paper-toast id="toast" text="done" horizontal-align="right" duration="6000"></paper-toast>


        <div class="container">

            <div class="po-wrapper file-contract-line">
                <div class="row">
                    <div class="mid code">
                        [[_selectedFile.name]]
                    </div>
                    <div class="right">
                        <!-- <span class="tag"  title="number of preconditions>[[file.functions.length]]</span> -->
                        <span class="tag tag-in" title="number of preconditions">[[_selectedFile.preconditionsCount]]</span>
                        <span class="tag tag-out" title="number of postconditions">[[_selectedFile.postconditionsCount]]</span>
                    </div>
                </div>
            </div>

            <contract-info 
                file="[[_selectedFile]]" 
                contract="[[_selectedFunc]]" 
                global-variables="[[_selectedFile.globalVariables]]"></contract-info>

            <div class="control-panel separated-top">
                <paper-button class="btn-save" raised on-tap="saveContracts">save</paper-button>
            </div>

        </div>

    </template>



    <script>
        Polymer({
            is: 'contracts-scene',
            properties: {

                selectedFile: {
                    type: Object,//CFile or dir
                    observer: "_selectedFileChanged"
                },

                selectedFunction: {
                    type: Object,//CFunction
                    notify: true,
                    observer: "_selectedFunctionChanged"
                },

                controller: {
                    type: Object
                },

                _selectedFunc: Object,
                _selectedFile: Object,
            },

            saveContracts: function () {
                const cb = (x) => {
                    this.$.toast.text = "Contract saved: " + x;
                    this.$.toast.open();
                }
                this.controller.saveContract(this._selectedFile, cb);
            },

            _rowClass: function (selected) {
                return selected ? "selected" : ""
            },
             
            _onContractFunctionSelected: function (e) {
                this._selectedFunc = e.detail;
            },


            _selectedFileChanged: function (e) {
                let fileContract = this.controller.getFileContracts(e);
                this._selectedFile = fileContract;
                // console.error(e)
            },

            _selectedFunctionChanged: function (cfun) {

                let functionContract = this.controller.getFunctionContracts(cfun);
                this._selectedFunc = functionContract;
                // console.error(functionContract);
            },

        });
    </script>

</dom-module>